import os
from dotenv import load_dotenv
{% if provider == 'openai' %}
from openai import OpenAI
{% elif provider == 'anthropic' %}
from anthropic import Anthropic
{% elif provider == 'google' %}
import google.generativeai as genai
{% endif %}

load_dotenv()

class {{ agent_name.replace(' ', '') }}Agent:
    def __init__(self):
        {% if provider == 'openai' %}
        self.client = OpenAI(api_key=os.getenv('OPENAI_API_KEY'))
        {% elif provider == 'anthropic' %}
        self.client = Anthropic(api_key=os.getenv('ANTHROPIC_API_KEY'))
        {% elif provider == 'google' %}
        genai.configure(api_key=os.getenv('GOOGLE_API_KEY'))
        self.model = genai.GenerativeModel('{{ model }}')
        {% endif %}
        
        self.system_prompt = """{{ system_prompt }}"""
        self.conversation_history = []
    
    def chat(self, user_message):
        """Send a message and get a response"""
        
        self.conversation_history.append({
            'role': 'user',
            'content': user_message
        })
        
        try:
            {% if provider == 'openai' %}
            response = self.client.chat.completions.create(
                model='{{ model }}',
                messages=[
                    {'role': 'system', 'content': self.system_prompt},
                    *self.conversation_history
                ],
                temperature={{ temperature }},
                max_tokens={{ max_tokens }}
            )
            
            assistant_message = response.choices[0].message.content
            
            {% elif provider == 'anthropic' %}
            response = self.client.messages.create(
                model='{{ model }}',
                max_tokens={{ max_tokens }},
                system=self.system_prompt,
                messages=self.conversation_history
            )
            
            assistant_message = response.content[0].text
            
            {% elif provider == 'google' %}
            # Convert conversation to Gemini format
            prompt = self.system_prompt + "\n\n"
            for msg in self.conversation_history:
                prompt += f"{msg['role']}: {msg['content']}\n"
            
            response = self.model.generate_content(prompt)
            assistant_message = response.text
            {% endif %}
            
            self.conversation_history.append({
                'role': 'assistant',
                'content': assistant_message
            })
            
            return assistant_message
            
        except Exception as e:
            print(f"Error: {e}")
            return "Sorry, I encountered an error. Please try again."
    
    def reset_conversation(self):
        """Clear conversation history"""
        self.conversation_history = []

def main():
    """Example usage"""
    agent = {{ agent_name.replace(' ', '') }}Agent()
    
    print("Agent initialized. Type 'quit' to exit.\n")
    
    while True:
        user_input = input("You: ")
        
        if user_input.lower() in ['quit', 'exit', 'q']:
            print("Goodbye!")
            break
        
        response = agent.chat(user_input)
        print(f"\nAgent: {response}\n")

if __name__ == "__main__":
    main()